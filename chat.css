:root{
  /* Thema */
  --cb-primary:#3f51b5; --cb-primary-contrast:#fff;
  --cb-bg:#fff; --cb-text:#1b1f24; --cb-user:#e8f0ff; --cb-bot:#f2f3f5;
  --cb-shadow:0 10px 30px rgba(0,0,0,.15);
  --cb-radius:16px; --cb-font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;

  /* Bubble */
  --cb-bubble-size:64px;
  --cb-bubble-gap:20px;

  /* Default window size (kan door JS overschreven worden) */
  --cb-width:380px; --cb-height:560px;

  /* Min/max voor resizen (JS hanteert dezelfde) */
  --cb-min-width:300px; --cb-min-height:360px;
}

/* Floating bubble */
.cb-bubble{
  position:fixed; right:var(--cb-bubble-gap); bottom:var(--cb-bubble-gap);
  width:var(--cb-bubble-size); height:var(--cb-bubble-size);
  border-radius:50%; box-shadow:var(--cb-shadow);
  cursor:pointer; z-index:9999; border:0; padding:0;
  background:none; outline-offset:3px;
  display:grid; place-items:center;
}
.cb-bubble:focus-visible{ outline:2px solid rgba(0,0,0,.2); }

/* Icon-lagen in de bubble (crossfade) */
.cb-icon{
  position:absolute; inset:0;
  width:100%; height:100%;
  border-radius:50%;
  object-fit:cover;
  transition:opacity .25s ease, transform .25s ease, filter .25s ease;
  will-change:opacity,transform;
  user-select:none; pointer-events:none;
}
.cb-icon-closed{ opacity:1; transform:scale(1); }
.cb-icon-open  { opacity:0; transform:scale(.9) rotate(-6deg); }
.cb-bubble.is-open .cb-icon-closed{ opacity:0; transform:scale(1.05) rotate(6deg); }
.cb-bubble.is-open .cb-icon-open  { opacity:1; transform:scale(1) rotate(0); }

/* Chat window (rechtsonder geankerd) */
.cb-window{
  position:fixed;
  right:calc(var(--cb-bubble-gap) - 4px);
  bottom:calc(var(--cb-bubble-gap) + var(--cb-bubble-size) + 10px);
  width:var(--cb-width); height:var(--cb-height);
  min-width:var(--cb-min-width); min-height:var(--cb-min-height);
  max-width:min(90vw, 760px); max-height:min(85vh, 900px);
  background:var(--cb-bg); color:var(--cb-text); font-family:var(--cb-font);
  border-radius:calc(var(--cb-radius) + 4px); box-shadow:var(--cb-shadow);
  display:none; overflow:hidden; z-index:9999;
  /* voorkom textselectie tijdens resize */
  user-select:none;
}
.cb-window.cb-open{ display:grid; grid-template-rows:auto 1fr auto; }

/* Header */
.cb-header{
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px;
  padding:14px 16px; background:var(--cb-primary); color:var(--cb-primary-contrast);
  cursor:default;
}
.cb-avatar{ width:40px;height:40px;border-radius:50%;overflow:hidden;background:rgba(255,255,255,.2);display:grid;place-items:center; }
.cb-avatar img{ width:100%;height:100%;object-fit:cover;display:block; }
.cb-title{ font-weight:600; letter-spacing:.2px; }
.cb-close{ opacity:.9; cursor:pointer; font-size:20px; line-height:1; }

/* Body */
.cb-body{
  padding:12px;
  overflow:auto;
  background:linear-gradient(#fff,#fff) padding-box;
  position:relative;          /* nodig voor watermark layering */
}

/* Watermark â€” ALTIJD onder de berichten */
.cb-watermark{
  position:absolute; inset:0;
  z-index:0;                   /* lager dan berichten */
  pointer-events:none;
  display:grid; place-items:center;
  opacity:.08;                 /* default; JS kan dit overschrijven */
}
.cb-watermark img{ max-width:60%; max-height:60%; filter:grayscale(100%); }
.cb-watermark.tiled{
  background-repeat:repeat;
  background-position:0 0;
  background-size:220px auto;
}
.cb-watermark-text{
  position:absolute; right:12px; bottom:8px;
  font-size:12px; opacity:.35;
  pointer-events:none; color:#000;
  mix-blend-mode:multiply;
}

/* Bubbles */
.cb-msg{
  position:relative; z-index:1;   /* BOVEN watermark */
  max-width:82%;
  padding:10px 12px;
  border-radius:14px;
  margin:8px 0;
  line-height:1.5;
  word-wrap:break-word;
  white-space:normal;
}
.cb-msg.bot  { background:var(--cb-bot); border-top-left-radius:4px; }
.cb-msg.user { background:var(--cb-user); border-top-right-radius:4px; margin-left:auto; }

/* Markdown typografie binnen berichten */
.cb-msg p{ margin:0 0 .5em 0; }
.cb-msg h1,.cb-msg h2,.cb-msg h3{ margin:.2em 0 .3em; line-height:1.25; }
.cb-msg h1{ font-size:1.15rem; }
.cb-msg h2{ font-size:1.1rem; }
.cb-msg h3{ font-size:1.05rem; }
.cb-msg strong{ font-weight:700; }
.cb-msg em{ font-style:italic; }

.cb-msg ul, .cb-msg ol{
  padding-left:1.2em; margin:.3em 0 .6em;
}
.cb-msg li{ margin:.15em 0; }

.cb-msg code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size:.9em; background:#f3f4f6; padding:.12em .35em; border-radius:6px;
}
.cb-msg pre{
  margin:.4em 0; background:#f6f7f9; border-radius:10px; padding:.6em .8em; overflow:auto;
}
.cb-msg pre code{ background:transparent; padding:0; }

/* Links & afbeeldingen */
.cb-msg a{
  color:var(--cb-primary);
  text-decoration:underline;
  word-break:break-word;
}
.cb-msg img.cb-img{
  max-width:100%;
  height:auto;
  display:block;
  border-radius:10px;
  margin:.35em 0 0;
}

/* Footer */
.cb-footer{
  display:grid; grid-template-columns:1fr auto;
  gap:8px; padding:10px; border-top:1px solid #ececec; background:#fafafa;
}
.cb-input{ border:1px solid #e2e2e2; padding:10px 12px; border-radius:12px; outline:none; font:inherit; background:#fff; }
.cb-send{ background:var(--cb-primary); color:var(--cb-primary-contrast); border:0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
.cb-send[disabled]{ opacity:.6; cursor:not-allowed; }

/* Typing */
.cb-typing{ display:inline-flex; gap:4px; align-items:center; margin-left:4px; }
.cb-dot{ width:6px; height:6px; border-radius:50%; background:#999; opacity:.5; animation:cbblink 1.2s infinite; }
.cb-dot:nth-child(2){ animation-delay:.2s; }
.cb-dot:nth-child(3){ animation-delay:.4s; }
@keyframes cbblink{ 0%,80%,100%{opacity:.2} 40%{opacity:.9} }

.cb-resize{
  position:absolute; left:3px; top:3px;
  width:18px; height:18px;
  border-radius:4px;
  cursor:nw-resize;
  z-index:2;
  background:
    linear-gradient(315deg, hsla(0, 0%, 100%, 0.5) 0 49%, transparent 50%) no-repeat,
    linear-gradient(315deg, transparent 0 49%, rgba(255, 255, 255, 0.5) 50%) no-repeat;
  background-size:100% 100%, 70% 70%;
  background-position:center, left top;
  opacity:0.1;
  transition:opacity .15s ease;
}
.cb-resize:hover{ opacity:1; }

@media (max-width:480px){
  .cb-window{ right:10px; left:10px; width:auto; height:70vh; }
  .cb-resize{ display:none; } /* op erg smalle schermen geen custom resize */
}